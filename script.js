
const translations = {
    ru: {
        // Navigation
        home: "Главная",
        lodges: "Наши ложи",
        recognition: "Мировое признание",
        council: "Совет ВО",
        contacts: "Контакты",
        joinButton: "Как стать масоном",
        
        // Mobile titles
        mobileTitle: "Великая Ложа",
        mobileSubtitle: "Казахстана",
        headerSubtitle: "Великая Ложа Казахстана",
        
        // Hero section
        heroTitle: "Великая ложа Казахстана",
        heroDesc: "Великая ложа Казахстана Grand Lodge of Qazaqstan ООО Великая ложа Казахстана — единственная регулярная и общепризнанная масонская организация в Республике Казахстан с 2016 года",
        
        // Grand Master
        grandMasterSubtitle: "Великий Мастер Великой Ложи Казахстана",
        grandMasterName: "Айдар Алпысбай",
        grandMasterQuote: "Добродетель — это основа нашей морали и этики. Пусть честность, справедливость и доброта будут твоими постоянными ориентирами. В каждом действии и решении стремись к высокому стандарту морали, отражая внутреннюю чистоту и уважение к окружающим.",
        
        // Masonic section
        masonicTitle: "Уважаемые читатели!",
        masonicDesc: "На территории Республики Казахстан вы можете посетить сайт только одной постоянной организации — Казахской Высшей ложи (КЛ), признанной и занимающейся работой со стороны постоянных высших лож мира. Хранитель древних традиций ордена Свободных каменщиков (масонов) и содействующий широкому распространению масонского света в нашей стране и других государствах.",
        
        // Values
        valuesTitle: "Наши ценности",
        value1Title: "Свет и Знание",
        value1Desc: "Мы стремимся к просвещению и распространению знаний, веря, что свет разума освещает путь к истине.",
        value2Title: "Этика и Честь",
        value2Desc: "Наша деятельность основывается на высоких моральных стандартах. Мы придерживаемся принципов честности, справедливости и ответственности.",
        value3Title: "Братство и Единство",
        value3Desc: "Мы объединяемся в духе братства, поддерживая друг друга и создавая крепкие связи, основанные на доверии и уважении.",
        
        // Lodges
        lodgesMainTitle: "Основные ложи\nв Казахстане",
        grandLodgeTitle: "Великая ложа Казахстана",
        foundedLabel: "Основано в 2016",
        dateFoundedLabel: "Дата основания:",
        languageLabel: "Язык проведения работ:",
        
        lodge1Title: "Достопочтенная ложа №1 «Алихан Букейханов»",
        lodge1Founded: "2016",
        lodge1Language: "Казахский, русский",
        
        lodge2Title: "Достопочтенная ложа №2 «Свет Востока»",
        lodge2Founded: "2016",
        lodge2Language: "Казахский, русский",
        
        lodge3Title: "Достопочтенная ложа №3 «United Nomadic Brothers»",
        lodge3Founded: "2016",
        lodge3Language: "Английский",
        
        lodge4Title: "Достопочтенная ложа №4 «Байтерек»",
        lodge4Founded: "2017",
        lodge4Language: "Казахский, русский",
        
        lodge5Title: "Достопочтенная ложа №5 «А.С. Пушкин»",
        lodge5Founded: "2018",
        lodge5Language: "Русский",
        
        // Footer
        footerStructure: "Структура",
        footerMission: "Миссия ценности цели",
        footerStructureVLK: "Структура ВЛК",
        footerCouncil: "Совет Великих Офицеров",
        footerDocuments: "Учредительные документы",
        footerRecognitions: "Международные признания",
        footerLibrary: "Библиотека",
        footerConstitution: "Конституция",
        footerMedia: "Информация в СМИ",
        footerDictionary: "Словарь терминов",
        footerBooks: "Популярные книги о масонстве",
        footerCandidate: "Кандидату",
        footerFaq: "Часто задаваемые вопросы",
        footerPreparing: "Подготовка к интервью",
        footerForm: "Анкета кандидата"
    },
    en: {
        // Navigation
        home: "Home",
        lodges: "Our Lodges",
        recognition: "World Recognition",
        council: "Council",
        contacts: "Contacts",
        joinButton: "How to join",
        
        // Mobile titles
        mobileTitle: "Grand Lodge",
        mobileSubtitle: "of Kazakhstan",
        headerSubtitle: "Grand Lodge of Kazakhstan",
        
        // Hero section
        heroTitle: "Grand Lodge of Kazakhstan",
        heroDesc: "Grand Lodge of Kazakhstan — the only regular and recognized Masonic organization in the Republic of Kazakhstan since 2016",
        
        // Grand Master
        grandMasterSubtitle: "Grand Master of the Grand Lodge of Kazakhstan",
        grandMasterName: "Aidar Alpysbay",
        grandMasterQuote: "Virtue is the foundation of our morality and ethics. Let honesty, justice and kindness be your constant guides. In every action and decision, strive for a high standard of morality, reflecting inner purity and respect for others.",
        
        // Masonic section
        masonicTitle: "Dear Readers!",
        masonicDesc: "On the territory of the Republic of Kazakhstan, you can visit the website of only one permanent organization — the Grand Lodge of Kazakhstan (GLK), recognized and working with permanent grand lodges around the world. Guardian of ancient traditions of the Order of Free and Accepted Masons (Freemasons) and promoting the widespread dissemination of Masonic light in our country and other states.",
        
        // Values
        valuesTitle: "Our Values",
        value1Title: "Light and Knowledge",
        value1Desc: "We strive for enlightenment and the dissemination of knowledge, believing that the light of reason illuminates the path to truth.",
        value2Title: "Ethics and Honor",
        value2Desc: "Our activities are based on high moral standards. We adhere to the principles of honesty, justice and responsibility.",
        value3Title: "Brotherhood and Unity",
        value3Desc: "We unite in the spirit of brotherhood, supporting each other and creating strong bonds based on trust and respect.",
        
        // Lodges
        lodgesMainTitle: "Main Lodges\nin Kazakhstan",
        grandLodgeTitle: "Grand Lodge of Kazakhstan",
        foundedLabel: "Founded in 2016",
        dateFoundedLabel: "Date Founded:",
        languageLabel: "Working Language:",
        
        lodge1Title: "Worshipful Lodge No. 1 «Alikhan Bukeikhanov»",
        lodge1Founded: "2016",
        lodge1Language: "Kazakh, Russian",
        
        lodge2Title: "Worshipful Lodge No. 2 «Light of the East»",
        lodge2Founded: "2016",
        lodge2Language: "Kazakh, Russian",
        
        lodge3Title: "Worshipful Lodge No. 3 «United Nomadic Brothers»",
        lodge3Founded: "2016",
        lodge3Language: "English",
        
        lodge4Title: "Worshipful Lodge No. 4 «Baiterek»",
        lodge4Founded: "2017",
        lodge4Language: "Kazakh, Russian",
        
        lodge5Title: "Worshipful Lodge No. 5 «A.S. Pushkin»",
        lodge5Founded: "2018",
        lodge5Language: "Russian",
        
        // Footer
        footerStructure: "Structure",
        footerMission: "Mission Values Goals",
        footerStructureVLK: "GLK Structure",
        footerCouncil: "Council of Grand Officers",
        footerDocuments: "Founding Documents",
        footerRecognitions: "International Recognitions",
        footerLibrary: "Library",
        footerConstitution: "Constitution",
        footerMedia: "Media Information",
        footerDictionary: "Dictionary of Terms",
        footerBooks: "Popular Books on Freemasonry",
        footerCandidate: "For Candidates",
        footerFaq: "Frequently Asked Questions",
        footerPreparing: "Interview Preparation",
        footerForm: "Candidate Application"
    },
    kz: {
        // Navigation
        home: "Басты бет",
        lodges: "Біздің ложалар",
        recognition: "Әлемдік мойындау",
        council: "Кеңес",
        contacts: "Байланыс",
        joinButton: "Қалай масон болуға болады",
        
        // Mobile titles
        mobileTitle: "Қазақстанның",
        mobileSubtitle: "Ұлы Ложасы",
        headerSubtitle: "Қазақстанның Ұлы Ложасы",
        
        // Hero section
        heroTitle: "Қазақстанның Ұлы Ложасы",
        heroDesc: "Қазақстанның Ұлы Ложасы — Қазақстан Республикасындағы жалғыз мойындалған масондық ұйым (2016 жылдан бастап)",
        
        // Grand Master
        grandMasterSubtitle: "Қазақстанның Ұлы Ложасының Ұлы Шебері",
        grandMasterName: "Айдар Алпысбай",
        grandMasterQuote: "Ізгілік — біздің моральдық пен этикамыздың негізі. Адалдық, әділдік және мейірбандық сіздің тұрақты бағдарыңыз болсын. Әрбір іс-әрекет пен шешімде жоғары моральдық стандартқа ұмтылыңыз, ішкі тазалық пен қоршағандарға құрметті көрсетіңіз.",
        
        // Masonic section
        masonicTitle: "Құрметті оқырмандар!",
        masonicDesc: "Қазақстан Республикасының аумағында сіз тек бір тұрақты ұйымның веб-сайтын - әлемнің тұрақты ұлы ложаларымен мойындалған және жұмыс істейтін Қазақстанның Ұлы Ложасына (ҰЛД) барысыз. Еркін және Қабылданған Тас қалаушылар (Масондар) орденінің ежелгі дәстүрлерінің сақшысы және біздің елімізде және басқа мемлекеттерде масондық жарықтың кең таралуына ықпал етуші.",
        
        // Values
        valuesTitle: "Біздің құндылықтарымыз",
        value1Title: "Жарық пен Білім",
        value1Desc: "Біз ағарту мен білімді тарату үшін күресеміз, ақыл-ойдың жарығы шындыққа апаратын жолды жарықтандырады деп сенеміз.",
        value2Title: "Этика мен Намыс",
        value2Desc: "Біздің қызметіміз жоғары моральдық стандарттарға негізделген. Біз адалдық, әділдік және жауапкершілік қағидаттарын ұстанамыз.",
        value3Title: "Бауырластық пен Бірлік",
        value3Desc: "Біз бауырластық рухында бірігіп, бір-бірімізді қолдап, сенім мен құрметке негізделген берік байланыстар құрамыз.",
        
        // Lodges
        lodgesMainTitle: "Қазақстандағы\nнегізгі ложалар",
        grandLodgeTitle: "Қазақстанның Ұлы Ложасы",
        foundedLabel: "2016 жылы құрылған",
        dateFoundedLabel: "Құрылған күні:",
        languageLabel: "Жұмыс тілі:",
        
        lodge1Title: "Құрметті ложа №1 «Әлихан Бөкейханов»",
        lodge1Founded: "2016",
        lodge1Language: "Қазақ, орыс",
        
        lodge2Title: "Құрметті ложа №2 «Шығыс жарығы»",
        lodge2Founded: "2016",
        lodge2Language: "Қазақ, орыс",
        
        lodge3Title: "Құрметті ложа №3 «United Nomadic Brothers»",
        lodge3Founded: "2016",
        lodge3Language: "Ағылшын",
        
        lodge4Title: "Құрметті ложа №4 «Бәйтерек»",
        lodge4Founded: "2017",
        lodge4Language: "Қазақ, орыс",
        
        lodge5Title: "Құрметті ложа №5 «А.С. Пушкин»",
        lodge5Founded: "2018",
        lodge5Language: "Орыс",
        
        // Footer
        footerStructure: "Құрылым",
        footerMission: "Миссия құндылықтар мақсаттар",
        footerStructureVLK: "ҰЛД құрылымы",
        footerCouncil: "Ұлы Офицерлер Кеңесі",
        footerDocuments: "Құрылтай құжаттары",
        footerRecognitions: "Халықаралық мойындаулар",
        footerLibrary: "Кітапхана",
        footerConstitution: "Конституция",
        footerMedia: "БАҚ-тағы ақпарат",
        footerDictionary: "Терминдер сөздігі",
        footerBooks: "Масондық туралы танымал кітаптар",
        footerCandidate: "Кандидатқа",
        footerFaq: "Жиі қойылатын сұрақтар",
        footerPreparing: "Сұхбатқа дайындық",
        footerForm: "Кандидат анкетасы"
    }
};


let currentLang = 'ru';
function updateTexts() {
    const texts = translations[currentLang];
    document.querySelectorAll('[data-text-key]').forEach(element => {
        const key = element.getAttribute('data-text-key');
        if (texts[key]) {
            element.textContent = texts[key];
        }
    });
    
    document.documentElement.lang = currentLang === 'kz' ? 'kk' : currentLang;

    const langLabels = { ru: 'Рус', en: 'Eng', kz: 'Қаз' };
    const currentLangElement = document.getElementById('currentLang');
    if (currentLangElement) {
        currentLangElement.textContent = langLabels[currentLang];
    }
}

function initLanguageSelector() {
    const langButton = document.getElementById('langButton');
    const langDropdown = document.getElementById('langDropdown');
    const langOptions = document.querySelectorAll('.lang-option');
    const mobileLangOptions = document.querySelectorAll('.mobile-lang-option');

    if (!langButton || !langDropdown) return;

    langButton.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = langDropdown.classList.contains('open');
        langDropdown.classList.toggle('open', !isOpen);
        langButton.setAttribute('aria-expanded', !isOpen);
    });

    document.addEventListener('click', () => {
        langDropdown.classList.remove('open');
        langButton.setAttribute('aria-expanded', 'false');
    });

    langOptions.forEach(option => {
        option.addEventListener('click', () => {
            const lang = option.getAttribute('data-lang');
            switchLanguage(lang);
        });
    });

    mobileLangOptions.forEach(option => {
        option.addEventListener('click', () => {
            const lang = option.getAttribute('data-lang');
            switchLanguage(lang);
        });
    });
}

function switchLanguage(lang) {
    if (lang && translations[lang]) {
        currentLang = lang;

        try {
            localStorage.setItem('lang', lang);
        } catch (error) {
            console.warn('Could not save language to localStorage:', error);
        }

        document.querySelectorAll('.lang-option').forEach(opt => {
            opt.classList.toggle('active', opt.getAttribute('data-lang') === lang);
        });
        
        document.querySelectorAll('.mobile-lang-option').forEach(opt => {
            opt.classList.toggle('active', opt.getAttribute('data-lang') === lang);
            opt.setAttribute('aria-checked', opt.getAttribute('data-lang') === lang);
        });
        
        updateTexts();
        announceLanguageChange(lang);
    }
}

function initMobileMenu() {
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobileMenu');
    const mobileMenuClose = document.getElementById('mobileMenuClose');
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link, .mobile-nav-button');

    if (!hamburger || !mobileMenu) return;

    function openMenu() {
        hamburger.classList.add('open');
        mobileMenu.classList.add('open');
        hamburger.setAttribute('aria-expanded', 'true');
        hamburger.setAttribute('aria-label', 'Закрыть меню');
        document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
        hamburger.classList.remove('open');
        mobileMenu.classList.remove('open');
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.setAttribute('aria-label', 'Открыть меню');
        document.body.style.overflow = '';
    }

    hamburger.addEventListener('click', () => {
        if (mobileMenu.classList.contains('open')) {
            closeMenu();
        } else {
            openMenu();
        }
    });

    if (mobileMenuClose) {
        mobileMenuClose.addEventListener('click', closeMenu);
    }
    mobileNavLinks.forEach(link => {
        link.addEventListener('click', closeMenu);
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && mobileMenu.classList.contains('open')) {
            closeMenu();
        }
    });
}
function announceLanguageChange(lang) {
    const announcement = document.createElement('div');
    announcement.setAttribute('aria-live', 'polite');
    announcement.setAttribute('aria-atomic', 'true');
    announcement.className = 'sr-only';
    
    const langNames = {
        'ru': 'русский',
        'en': 'английский', 
        'kz': 'казахский'
    };
    
    announcement.textContent = `Язык изменен на ${langNames[lang]}`;
    document.body.appendChild(announcement);
    
    setTimeout(() => {
        if (document.body.contains(announcement)) {
            document.body.removeChild(announcement);
        }
    }, 1000);
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    // Load saved language
    let savedLang = 'ru';
    try {
        savedLang = localStorage.getItem('lang') || 'ru';
    } catch (error) {
        console.warn('Could not load language from localStorage:', error);
    }
    
    if (savedLang && translations[savedLang]) {
        switchLanguage(savedLang);
    } else {
        updateTexts();
    }

    initLanguageSelector();
    initMobileMenu();

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                const headerHeight = document.querySelector('.header').offsetHeight;
                const targetPosition = targetElement.offsetTop - headerHeight - 20;
                
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });

    const heroVideo = document.querySelector('.hero-video');
    if (heroVideo) {
        heroVideo.addEventListener('error', function() {
            console.log('Video loading error, using fallback image');
            const heroSection = document.querySelector('.hero');
            heroSection.style.backgroundImage = 'url("./bg.jpg")';
            heroSection.style.backgroundSize = 'cover';
            heroSection.style.backgroundPosition = 'center 40%';
            this.style.display = 'none';
        });

        heroVideo.addEventListener('loadeddata', function() {
            console.log('Video loaded successfully');
        });
    }
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                    }
                    observer.unobserve(img);
                }
            });
        });

        document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
        });
    }


    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        document.documentElement.style.setProperty('--animation-duration', '0.01ms');
    }

    const focusableElements = 'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';
    
    const mobileMenu = document.getElementById('mobileMenu');
    if (mobileMenu) {
        const firstFocusableElement = mobileMenu.querySelectorAll(focusableElements)[0];
        const focusableContent = mobileMenu.querySelectorAll(focusableElements);
        const lastFocusableElement = focusableContent[focusableContent.length - 1];

        document.addEventListener('keydown', function(e) {
            if (!mobileMenu.classList.contains('open')) return;

            if (e.key === 'Tab') {
                if (e.shiftKey) {
                    if (document.activeElement === firstFocusableElement) {
                        lastFocusableElement.focus();
                        e.preventDefault();
                    }
                } else {
                    if (document.activeElement === lastFocusableElement) {
                        firstFocusableElement.focus();
                        e.preventDefault();
                    }
                }
            }
        });
    }

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const langDropdown = document.getElementById('langDropdown');
            const langButton = document.getElementById('langButton');
            if (langDropdown && langDropdown.classList.contains('open')) {
                langDropdown.classList.remove('open');
                if (langButton) langButton.focus();
            }
        }
        if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
            const langDropdown = document.getElementById('langDropdown');
            if (langDropdown && langDropdown.classList.contains('open')) {
                e.preventDefault();
                const options = Array.from(langDropdown.querySelectorAll('.lang-option'));
                const currentIndex = options.findIndex(option => option === document.activeElement);
                
                let nextIndex;
                if (e.key === 'ArrowDown') {
                    nextIndex = currentIndex < options.length - 1 ? currentIndex + 1 : 0;
                } else {
                    nextIndex = currentIndex > 0 ? currentIndex - 1 : options.length - 1;
                }
                
                if (options[nextIndex]) {
                    options[nextIndex].focus();
                }
            }
        }
    });

    console.log('Grand Lodge of Kazakhstan website initialized successfully');
});

function handleViewportChange() {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}

window.addEventListener('resize', handleViewportChange);
window.addEventListener('orientationchange', handleViewportChange);
handleViewportChange(); 


function preloadImage(url) {
    const img = new Image();
    img.src = url;
}


preloadImage('./logo.png');
preloadImage('./master1.png');


document.addEventListener('error', function(e) {
    if (e.target.tagName === 'IMG') {
        console.warn('Failed to load image:', e.target.src);
    }
}, true);

if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
    });
}
function initScrollAnimation() {

    if (window.innerWidth > 767) return;

    const observerOptions = {
        threshold: 0.15,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, observerOptions);

    const sectionsToAnimate = [
        '.grand-master',
        '.masonic-section',
        '.values',
        '.lodges'
    ];

    sectionsToAnimate.forEach(selector => {
        const section = document.querySelector(selector);
        if (section) {
            section.classList.add('scroll-animate');
            observer.observe(section);

            // Анимируем дочерние элементы
            if (selector === '.values') {
                const valueCards = section.querySelectorAll('.value-card');
                valueCards.forEach(card => {
                    card.classList.add('scroll-animate');
                    observer.observe(card);
                });
            }

            if (selector === '.lodges') {
                const lodgeCards = section.querySelectorAll('.lodges-grid-sm .lodge-card');
                lodgeCards.forEach(card => {
                    card.classList.add('scroll-animate');
                    observer.observe(card);
                });

                const lodgesHeader = section.querySelector('.lodges-header-container');
                if (lodgesHeader) {
                    lodgesHeader.classList.add('scroll-animate');
                    observer.observe(lodgesHeader);
                }
            }
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    initScrollAnimation();
});

window.addEventListener('resize', () => {
   
    if (window.innerWidth <= 767) {
        initScrollAnimation();
    }
});